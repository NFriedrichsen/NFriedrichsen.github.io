---
title: "STA209 - Hypothesis Testing Lab"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      fig.align = 'center', 
                      fig.width = 4, 
                      fig.height = 4, 
                      message = FALSE, 
                      warning = FALSE)
sol <- FALSE
library(kableExtra)
library(ggplot2)
library(dplyr)
```

## Introduction

This lab will introduce the idea of hypothesis testing using functions in R. We will look first at performing t-tests. By t-test, we simply mean performing a hypothesis test in which we construct a test statistic, $t$ (sometimes also written as capital $T$) that follows a t-distribution. We will then see how to do hypothesis tests with proportions as well (Z-tests) next week.

**Note:** You've already seen how to do these by hand! We are just figuring out how to do it in R

---

# Testing means

## One sample tests

In R, we can create perform hypothesis testing and create standard confidence intervals based on the $t$-distribution using the function `t.test()`. While the `t.test()` function will take a number of useful arguments that we will use in the future, for now we only concern ourselves with three:

  - `x`, a numeric vector of data we wish to construct a confidence interval for
  - `mu`, a single number indicating the null hypothesis value
  - `conf.level` which gives the confidence interval for a specified significance level $\alpha$ (i.e., our confidence interval is $1 - \alpha$)
  
The output of the `t.test()` function will include a collection of useful information, ranging from the point estimate for the mean value of `x`, as well as a confidence interval for this value. For example, consider the built-in dataset `mtcars` (data on cars we've seen before) in R. Here, we use `t.test()` to find a 90% confidence interval for average miles per gallon:

```{r}
t.test(mtcars$mpg, conf.level = 0.9)
```

From the output, you should note a few things:

  1. At the bottom of the output, we see our point estimate, $\overline{x} = 20.09$
  2. Just above the point estimate, we see our estimate of the 90% confidence interval, here $(18.24, 21.89)$
  3. All of the information above this is related to *hypothesis testing*. This includes:
    
      - A $T$-statistic, equal to $T = 18.9$
      - Degrees of freedom equal to $df = 31$
      - p-value $< 2 \times 10^{-15}$
    
However, as we did not specify any hypothesis test in this particular example, this information can be ignored.
    
By default, the `t.test()` function assumes a null hypothesis of $H_0: \mu_0 = 0$. As our t-statistic is computed as 

$$
T = \frac{\overline{x} - \mu_0}{\hat{\sigma}/\sqrt{n}}
$$
this gives rise to the computed statistic $T = 18.9$ that we saw in the output (and was subsequently used to compute the p-value).

To see a more realistic example, suppose we wanted to investigate the hypothesis that the average miles per gallon was equal to 18 mpg. That is, suppose we have $H_0: \mu = 18$. We could evaluate this hypothesis using the `t.test` function with the `mu` argument:

```{r}
t.test(x = mtcars$mpg, 
       mu = 18, 
       conf.level = 0.9)
```

In this example, note that our point estimate did not change, nor did our 90\% confidence interval. What did change, however, was the calculated t-statistic as well as the p-value. 

### Question 1

**Part A**: Explain why both the t-statistic and the p-value changed in our second call of `t.test()` above, while the point estimate and the confidence interval stayed the same.

**Part B**: Using the subsets of the data below, find and report 95\% confidence intervals for total enrollment at public and private colleges (two different CIs)

```{r}
library(dplyr)
college <- read.csv("https://collinn.github.io/data/college2019.csv")

col_priv <- filter(college, Type == "Private")
col_pub <- filter(college, Type == "Public")
```

```{r, echo=F, eval=F}
t.test(x=col_priv$Enrollment, conf.level=.95)
t.test(x=col_pub$Enrollment, conf.level=.95)
```
### Question 2

Below is code to create two datasets of information on captured Red-tail hawks. The `hawks2` dataset is a subset of `hawks`, but with the sample size reduced down to 20.


```{r}
## RT Hawk data
hawks <- read.csv("https://collinn.github.io/data/hawks.csv")
hawks <- filter(hawks, Species == "RT")

## Subset of RT Hawk data
set.seed(89)
idx <- sample(seq_len(nrow(hawks)), size = 20)
hawks2 <- hawks[idx, ]
```


**Hawk 2A:** Find the mean body weight for Red-tailed hawks in both the `hawks` and `hawks2` datasets. How do they compare?
  
```{r, echo=F, eval=F}
mean(hawks$Weight)
mean(hawks2$Weight)
```

**Hawk 2B:** Using the average weight of the Red-tailed's hawks, perform a t-test on each dataset to test the hypothesis that $\mu = 1050$. If you were testing at the $\alpha = 0.05$ level, which would you conclude?
  
```{r, echo=F, eval=F}
t.test(hawks$Weight, mu=1050, conf.level=.95)
t.test(hawks2$Weight, mu=1050, conf.level=.95)
```

**Hawk 2C:** Explain why the conclusions you came to were different in Part C.

---

## Two Sample Tests

Using R to perform two sample $t$-tests is an immediate extension from the one variable case in that the same function is used, along with the same arguments. Before, we had to be careful to specify the function argument `mu` to state what our null hypothesis was; in the two sample case, however, the default value of `mu = 0` will typically be what we want. 

### Two Sample t-test

There are two ways to pass an argument to the `t.test()` function for two sample data, depending on how the data is arranged. The first type of data arrangement, called "long format" describe a situation in which one column has the group name and the other has the value we are interested in. In the `mtcars` dataset, for example, we see that the `am` column designates if the vehicle has automatic or manual transmission, while the `qsec` column gives the quarter mile time of a vehicle

```{r}
head(mtcars)
```

To use this data in the `t.test()` function, we will use a formula syntax that is of the form `outcome ~ group`, along with an argument showin which dataset we are using:

```{r}
t.test(qsec ~ am, data = mtcars)
```

The other method is appropriate when the two values we want to compare each exist in their own column. For example, the college dataset has one column each for male and female four-year graduation rates. To test for a difference in these, we would pass each in separately:

```{r}
t.test(college$FourYearComp_Males, college$FourYearComp_Females)
```

Here, we see compelling evidence that the four year graduation rate for women is not equal to the four year graduation rate for men.

### Question 3

For this question, we will be using the sandwhich dataset which includes the number of ants found on a sandwich left out at a picnic according to the toppings, bread, and butter that was on it

```{r}
sandwich <- read.csv("https://collinn.github.io/data/sandwich.csv")
```

Perform a two sample t-test to determine if the mean value of ants on a sandwhich was the same for sandwiches that had butter compared to those that did not

```{r, echo = FALSE, include = FALSE, eval = FALSE}
t.test(Ants ~ Butter, sandwich)
```

### Question 4

For this question we will be using the hawks dataset. Use the following code with `dplyr` to `filter` the datset to only include sharp-shinned hawks,  `Species == "SS"`

```{r}
hawks <- read.csv("https://collinn.github.io/data/hawks.csv")

## (Do this for part 1)
hawks <- filter(hawks, Species == "SS")
```

  1. Create a boxplot showing the distribution of hallux length in sharp-shinned hawks for each of the two sexes. What do you notice?
  2. Perform a two-sample t-test to determine if there is evidence suggesting a difference in average hallux (killing talon) length between male and female hawks. Based on this test, what would you conclude?
  3. `filter` your sharp-shinned dataset again to remove outliers, using the criterion `Hallux < 50`
  
```{r}
## (Do this for part 3)
hawks <- filter(hawks, Hallux < 50)
```
  4. Recreate your boxplot and repeat your test from part (1) and (2). What impact did outliers have on the results of your test? Why do you think that is?

```{r, eval = FALSE, echo = FALSE}
ggplot(hawks, aes(Hallux, Sex)) + geom_boxplot()
t.test(Hallux ~ Sex, hawks)
```

---

### Paired Testing

We can implement *paired* t-tests in R by simplying setting the argument `paired = TRUE` in the `t.test()` function. Here, for example, is the data for our French language institute we saw in class:

```{r}
french <- read.csv("https://collinn.github.io/data/french_institute.csv")

head(french)
```

Because pre and post test scores are each contained in their own column, we will use the second method of passing in our arguments to the `t.test()` function

```{r}
t.test(french$pre, french$post, paired = TRUE)
```


### Question 5

Use the following code to create a new variable in the `french` dataset called `diff`. Perform a one-sample t-test on this variable and compare it with the paired output above. How do the t-statistic, degrees of freedom, and p-values compare?

```{r}
french <- french %>% mutate(diff = post-pre)
head(french)
```
